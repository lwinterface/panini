
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>Quickstart - Panini</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-simple-listener-app-example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Panini" class="md-header__button md-logo" aria-label="Panini" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Panini
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lwinterface/panini" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lwinterface/panini
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Panini" class="md-nav__button md-logo" aria-label="Panini" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Panini
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lwinterface/panini" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lwinterface/panini
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../What_is_NATS.md" class="md-nav__link">
        üè∞ What is NATS?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Install.md" class="md-nav__link">
        üöö Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Quickstart.md" class="md-nav__link">
        üç≥ Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          üë©‚Äçüéì Panini interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="üë©‚Äçüéì Panini interface" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          üë©‚Äçüéì Panini interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Panini_App_Arguments.md" class="md-nav__link">
        App Arguments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Panini_App_Functions.md" class="md-nav__link">
        App Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Incoming_Message_Structure.md" class="md-nav__link">
        Incoming message structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Panini_Validation.md" class="md-nav__link">
        How to validate that microservice connected to NATS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Datatypes.md" class="md-nav__link">
        üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Datatypes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Authentication.md" class="md-nav__link">
        üîë Authentication
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Data_Validation.md" class="md-nav__link">
        üëÆ‚Äç‚ôÇÔ∏è Incoming data validation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Middlewares.md" class="md-nav__link">
        üññ Middlewares
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../HTTP_server.md" class="md-nav__link">
        ü¶Ü HTTP server
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../WebSocket_server.md" class="md-nav__link">
        ü¶Ö WebSocket server example
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Balancer.md" class="md-nav__link">
        ü§π Balancer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../JetStream.md" class="md-nav__link">
        ‚õì JetStream
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Application_monitoring.md" class="md-nav__link">
        üëÄ Application Monitoring
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Emulator.md" class="md-nav__link">
        üï∞Ô∏è Emulator - "time machine" debug
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Distributed_tracing.md" class="md-nav__link">
        üîç Distributed tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment.md" class="md-nav__link">
        üèóÔ∏è Deployment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Changelog.md" class="md-nav__link">
        üìã Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../License.md" class="md-nav__link">
        üóΩ License
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../How_to_contribute.md" class="md-nav__link">
        üëê How to contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Testing.md" class="md-nav__link">
        üîß Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Logger.md" class="md-nav__link">
        üìã Logger
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-listener-app-example" class="md-nav__link">
    A simple listener app example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-app-example-that-generates-messages" class="md-nav__link">
    A simple app example that generates messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-possibilities" class="md-nav__link">
    More possibilities
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Quickstart</h1>

<p>Panini is a modern framework for fast and straightforward microservice development. It's a Flask-like solution but for NATS streaming. </p>
<p>For this quickstart, we expect the reader to have a minimal experience with:</p>
<ul>
<li>Python</li>
<li>basic knowledge about NATS</li>
<li>FastAPI or Aiohttp or Flask</li>
</ul>
<h2 id="a-simple-listener-app-example">A simple listener app example<a class="headerlink" href="#a-simple-listener-app-example" title="Permanent link">&para;</a></h2>
<p>A minimal app with one stream endpoint, one request endpoint, and one periodic task might look like this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">panini</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">panini_app</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">panini_app</span><span class="o">.</span><span class="n">App</span><span class="p">(</span>
        <span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;listener_app&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">4222</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;some.subject.for.request&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">request_listener</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; request endpoint &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;request </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2"> has been processed&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;request has been processed&quot;</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s2">&quot;some.subject.for.stream&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">stream_listener</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; stream endpoint &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;event </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2"> has been processed&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p>What's going on here?</p>
<ol>
<li>Imported Panini.</li>
<li>Initialized app. Created an instance of class App from module panini with any microservice name, NATS host, and port.</li>
<li>First <span class="red"><code>@app.listen</code></span> registers the listening subject <span class="red"><code>"some.subject.for.request"</code></span> with <span class="red"><code>request_listener</code></span>. Every time this app receives a request addressed to <span class="red"><code>"some.subject.for.request"</code></span>, the function <span class="red"><code>request_listener</code></span> is called to process it, then it sends a return response back to an addressee.</li>
<li>Secondly <span class="red"><code>@app.listen</code></span> register the listening subject <span class="red"><code>"some.subject.for.stream"</code></span> with <span class="red"><code>stream_listener</code></span>. Same as with <span class="red"><code>request_listener</code></span> but without sending the result back.</li>
<li><span class="red"><code>app.start()</code></span> runs an app. No code under this command will ever be called.</li>
</ol>
<p>Save the above code to file <em>listener*_*app.py.</em></p>
<div class="attention">
<p class="attention__emoji-icon">üí°</p><p> The current function expects only JSON formattable returns, dict or list. However, you can also specify it as string or bytes. More details about this in Datatypes section.</p>
</div>

<p>Make sure that you have all prerequisites from Install. Open the terminal to run the app:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span> <span class="n">python3</span> <span class="n">listener_app</span><span class="o">.</span><span class="n">py</span>
<span class="o">======================================================================================</span>
<span class="n">Panini</span> <span class="n">service</span> <span class="n">connected</span> <span class="n">to</span> <span class="n">NATS</span><span class="o">..</span>
<span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">listener_app__non_docker_env_270377__75017</span>

<span class="n">NATS</span> <span class="n">brokers</span><span class="p">:</span>
<span class="o">*</span>  <span class="n">nats</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4222</span>
<span class="o">======================================================================================</span>
</code></pre></div>
<p>That's it. Now let's create something that will generate messages.</p>
<h2 id="a-simple-app-example-that-generates-messages">A simple app example that generates messages<a class="headerlink" href="#a-simple-app-example-that-generates-messages" title="Permanent link">&para;</a></h2>
<p>Our goal here is to trigger endpoints from listener app above: </p>
<ul>
<li><span class="purple">"some.subject.for.request"</span>  - request something, receive response</li>
<li><span class="purple">"some.subject.for.stream"</span> - send some event without waiting for response</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">panini</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">panini_app</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">panini_app</span><span class="o">.</span><span class="n">App</span><span class="p">(</span>
        <span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;sender_app&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">4222</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">request_periodically</span><span class="p">():</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;request1234567890&quot;</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
        <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;some.subject.for.request&quot;</span><span class="p">,</span> 
        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">publish_periodically</span><span class="p">():</span>
    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;event1234567890&quot;</span><span class="p">}</span>
    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
        <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;some.subject.for.stream&quot;</span><span class="p">,</span> 
        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<p>What's new here:</p>
<ol>
<li>First, <span class="red"><code>@app.task</code></span> registers function <span class="red"><code>request_periodically</code></span> to call it periodically at given interval, each 1 second in the example.</li>
<li>Function <span class="red"><code>app.request</code></span> sends requests, asynchronously waits for a response.</li>
<li>The second <span class="red"><code>@app.task</code></span> does the same as the first one but for publishing.</li>
<li>Function <span class="red"><code>app.publish</code></span> sends a message like a request but without expecting any response. Fire and forget.</li>
</ol>
<p>Save the code to new file <em>sender_app.py.</em></p>
<p>Make sure that <em>listener_app.py</em> keeps running, then open a new terminal session to run the sender app:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span> <span class="n">python3</span> <span class="n">sender_app</span><span class="o">.</span><span class="n">py</span>
<span class="o">======================================================================================</span>
<span class="n">Panini</span> <span class="n">service</span> <span class="n">connected</span> <span class="n">to</span> <span class="n">NATS</span><span class="o">..</span>
<span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">sender_app__non_docker_env_270377__75017</span>

<span class="n">NATS</span> <span class="n">brokers</span><span class="p">:</span>
<span class="o">*</span>  <span class="n">nats</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">4222</span>
<span class="o">======================================================================================</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;request has been processed&#39;</span><span class="p">}</span>
</code></pre></div>
<p>Note that in the terminal session where you run <em>listener_app.py</em> you should see received requests and events:</p>
<div class="highlight"><pre><span></span><code><span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">event</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;event1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.stream</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
<span class="n">request</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;request1234567890&#39;</span><span class="p">}</span> <span class="kn">from</span> <span class="nn">some.subject.for.request</span> <span class="n">has</span> <span class="n">been</span> <span class="n">processed</span>
</code></pre></div>
<h2 id="more-possibilities">More possibilities<a class="headerlink" href="#more-possibilities" title="Permanent link">&para;</a></h2>
<p>In the first example, we created an application that listens for messages, in the second example, an application that sends messages. Panini allows you to freely combine sending and receiving messages in one application. </p>
<p>Let's check out what else you can do with Panini using a minimal interface:</p>
<ul>
<li>One-time tasks on start. Similar to the above periodic task but without <span class="red"><code>interval</code></span> argument</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">()</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">publish</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">get_some_update</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;some.subject&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Synchronous endpoints</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">your_periodic_task</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">publish_sync</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;some.publish.subject&#39;</span><span class="p">,</span> 
            <span class="n">message</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;some&#39;</span><span class="p">:</span><span class="s1">&#39;data&#39;</span><span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
<ul>
<li>Accept different datatypes: dict, str, bytes</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">timer_task</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">your_periodic_task</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">publish_sync</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;some.publish.subject&#39;</span><span class="p">,</span> 
            <span class="n">message</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;messageinbytestosend&#39;</span><span class="p">,</span> 
            <span class="n">data_type</span><span class="o">=</span><span class="nb">bytes</span>
        <span class="p">)</span>
</code></pre></div>
<ul>
<li>Create middlewares for NATS messages</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">panini.middleware</span> <span class="kn">import</span> <span class="n">Middleware</span>

<span class="k">class</span> <span class="nc">MyMiddleware</span><span class="p">(</span><span class="n">Middleware</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">publish_func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something before publish&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">publish_func</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something after publish&#39;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">listen_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something before listen&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">cb</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something after listen&#39;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">request_func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something before send request&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request_func</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something after send request&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">listen_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something before listen request&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cb</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do something after listen request&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<ul>
<li>
<p>Create HTTP endpoints with¬†<a href="https://github.com/aio-libs/aiohttp">Aiohttp</a>¬†and NATS endpoints all together in one microservice</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="s1">&#39;some.publish.subject&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">subject_for_requests_listener</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="n">handle_incoming_message</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">web_endpoint_listener</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single HTTP endpoint</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;/path/to/rest/endpoints&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HTTP endpoints for REST schema</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, REST world&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, REST world&quot;</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Built-in traffic balancing between instances of the microservice if you have high loads</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">app</span> <span class="o">=</span> <span class="n">panini_app</span><span class="o">.</span><span class="n">App</span><span class="p">(</span>
        <span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;async_publish&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="n">allocation_queue_group</span><span class="o">=</span><span class="s1">&#39;group24&#39;</span><span class="p">,</span> 
        <span class="n">port</span><span class="o">=</span><span class="mi">4222</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># incoming traffic will be distributed among </span>
<span class="c1"># all microservices that are in the &quot;group24&quot;</span>
</code></pre></div>
<p>Need more examples? Check <a href="https://github.com/lwinterface/panini/tree/master/examples">here</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>